<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.0.1 docs-doc-page docs-doc-id-rocketchat/rocketchat-oauth-process" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">RocketChat Oauth flow | WoofWoof</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://vulnsystem.github.io/zh-CN/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://vulnsystem.github.io/zh-CN/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://vulnsystem.github.io/zh-CN/docs/rocketchat/rocketchat-oauth-process"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="3.0.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.0.1"><meta data-rh="true" name="docsearch:version" content="3.0.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.0.1"><meta data-rh="true" property="og:title" content="RocketChat Oauth flow | WoofWoof"><meta data-rh="true" name="description" content="The process of rocketchat oauth"><meta data-rh="true" property="og:description" content="The process of rocketchat oauth"><link data-rh="true" rel="icon" href="/zh-CN/img/docusaurus.ico"><link data-rh="true" rel="canonical" href="https://vulnsystem.github.io/zh-CN/docs/rocketchat/rocketchat-oauth-process"><link data-rh="true" rel="alternate" href="https://vulnsystem.github.io/docs/rocketchat/rocketchat-oauth-process" hreflang="en"><link data-rh="true" rel="alternate" href="https://vulnsystem.github.io/zh-CN/docs/rocketchat/rocketchat-oauth-process" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://vulnsystem.github.io/docs/rocketchat/rocketchat-oauth-process" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X1Z85QJPUV-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="WoofWoof RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="WoofWoof Atom Feed">
<link rel="alternate" type="application/json" href="/zh-CN/blog/feed.json" title="WoofWoof JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="WoofWoof" href="/zh-CN/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/changelog/rss.xml" title="Docusaurus changelog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/changelog/atom.xml" title="Docusaurus changelog Atom Feed">
<link rel="alternate" type="application/json" href="/zh-CN/changelog/feed.json" title="Docusaurus changelog JSON Feed">



<link rel="icon" href="/zh-CN/img/docusaurus.png">
<link rel="manifest" href="/zh-CN/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/zh-CN/img/docusaurus.png">
<link rel="mask-icon" href="/zh-CN/img/docusaurus.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/zh-CN/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">



<link rel="alternate" type="application/rss+xml" href="/zh-CN/tests/blog/rss.xml" title="Docusaurus Tests Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/tests/blog/atom.xml" title="Docusaurus Tests Blog Atom Feed">
<link rel="alternate" type="application/json" href="/zh-CN/tests/blog/feed.json" title="Docusaurus Tests Blog JSON Feed">




<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/zh-CN/assets/css/styles.d3ec461e.css">
<script src="/zh-CN/assets/js/runtime~main.87243779.js" defer="defer"></script>
<script src="/zh-CN/assets/js/main.2637a990.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ"><a class="skipToContent_UHvc" href="#__docusaurus_skipToContent_fallback">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><nav aria-label="‰∏ªÂØºËà™" class="navbar navbar--fixed-top navbarHideable_uAgx"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ÂàáÊç¢ÂØºËà™Ê†è" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/docusaurus.svg" alt="" class="themedComponent_bJGS themedComponent--light_LEkC" height="32" width="32"><img src="/zh-CN/img/docusaurus_keytar.svg" alt="" class="themedComponent_bJGS themedComponent--dark_jnGk" height="32" width="32"></div><b class="navbar__title text--truncate">WoofWoof</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs">Developer</a><a class="navbar__item navbar__link" href="/zh-CN/blog">Blog</a><a class="navbar__item navbar__link" href="/zh-CN/showcase">Showcase</a><a class="navbar__item navbar__link" href="/zh-CN/community/support">Community</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs">3.0.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/docs/next/rocketchat/rocketchat-oauth-process">Canary üöß</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh-CN/docs/rocketchat/rocketchat-oauth-process">3.0.1</a></li><li><a class="dropdown__link" href="/zh-CN/docs/3.0.0">3.0.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_tqOs"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>‰∏≠ÊñáÔºà‰∏≠ÂõΩÔºâ</a><ul class="dropdown__menu"><li><a href="/docs/rocketchat/rocketchat-oauth-process" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-CN/docs/rocketchat/rocketchat-oauth-process" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">‰∏≠ÊñáÔºà‰∏≠ÂõΩÔºâ</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://github.com/vulnsystem/vulnsystem.github.io/issues/3526" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/vulnsystem/vulnsystem.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_dDCC"><button type="button" class="DocSearch DocSearch-Button" aria-label="ÊêúÁ¥¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">ÊêúÁ¥¢</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_PEsc"><div class="docsWrapper_lLmf"><button aria-label="ÂõûÂà∞È°∂ÈÉ®" class="clean-btn theme-back-to-top-button backToTopButton_PuQw" type="button"></button><div class="docRoot_kBZ6"><aside class="theme-doc-sidebar-container docSidebarContainer_S51O"><div class="sidebarViewport_K3q9"><div class="sidebar_vtcw sidebarWithHideableNavbar_tZ9s"><a tabindex="-1" class="sidebarLogo_UK0N" href="/zh-CN/"><img src="/zh-CN/img/docusaurus.svg" alt="" class="themedComponent_bJGS themedComponent--light_LEkC" height="32" width="32"><img src="/zh-CN/img/docusaurus_keytar.svg" alt="" class="themedComponent_bJGS themedComponent--dark_jnGk" height="32" width="32"><b>WoofWoof</b></a><nav aria-label="ÊñáÊ°£‰æßËæπÊ†è" class="menu thin-scrollbar menu_rWGR"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/zh-CN/docs/category/getting-started">Getting Started</a><button aria-label="ÊäòÂè†‰æßËæπÊ†èÂàÜÁ±ª &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/tokengeneration">Token generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/kafkaclients">Kafka clients</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/restapis">REST APIs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/streamclients">Stream Clients</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/category/guides">Guides</a><button aria-label="Â±ïÂºÄ‰æßËæπÊ†èÂàÜÁ±ª &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh-CN/docs/rocketchat/rocketchat-oauth">RocketChat Oauth</a><button aria-label="ÊäòÂè†‰æßËæπÊ†èÂàÜÁ±ª &#x27;RocketChat Oauth&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/docs/rocketchat/rocketchat-oauth-process">RocketChat Oauth flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/rocketchat/rocketchat-microsoft-oauth">Auth with Microsoft code flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/rocketchat/debugging-with-ngrok">Debugging with Ngrok</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/rocketchat/stream-feeds">Steam feeds</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/stream/stream-getstreamio">Chat Messaging</a><button aria-label="Â±ïÂºÄ‰æßËæπÊ†èÂàÜÁ±ª &#x27;Chat Messaging&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/kaleidoscope">Kaleidoscope</a><button aria-label="Â±ïÂºÄ‰æßËæπÊ†èÂàÜÁ±ª &#x27;Kaleidoscope&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh-CN/docs/docusaurus-quickstart">Docusaurus</a><button aria-label="Â±ïÂºÄ‰æßËæπÊ†èÂàÜÁ±ª &#x27;Docusaurus&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Êî∂Ëµ∑‰æßËæπÊ†è" aria-label="Êî∂Ëµ∑‰æßËæπÊ†è" class="button button--secondary button--outline collapseSidebarButton_PUyN"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_DI0B"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_EfwR"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_n6xZ"><div class="docItemContainer_RhpI"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Wvrh" aria-label="È°µÈù¢Ë∑ØÂæÑ"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="‰∏ªÈ°µÈù¢" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_uaSn"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh-CN/docs/rocketchat/rocketchat-oauth"><span itemprop="name">RocketChat Oauth</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">RocketChat Oauth flow</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">ÁâàÊú¨Ôºö3.0.1</span><div class="tocCollapsible_BEWm theme-doc-toc-mobile tocMobile_NSfz"><button type="button" class="clean-btn tocCollapsibleButton_IbtT">Êú¨È°µÊÄªËßà</button></div><div class="theme-doc-markdown markdown"><h1>RocketChat Oauth flow</h1>
<div class="theme-admonition theme-admonition-info admonition_o5H7 alert alert--info"><div class="admonitionHeading_FzoX"><span class="admonitionIcon_rXq6"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Useful links</div><div class="admonitionContent_Knsx"><p><a href="https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-auth-code-flow" target="_blank" rel="noopener noreferrer"><code>Microsoft OAuth 2.0 authorization code flow</code></a></p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="rocketchat-oauth-configuration">RocketChat Oauth configuration<a href="#rocketchat-oauth-configuration" class="hash-link" aria-label="RocketChat Oauth configurationÁöÑÁõ¥Êé•ÈìæÊé•" title="RocketChat Oauth configurationÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="generate-loginurl">Generate LoginURL<a href="#generate-loginurl" class="hash-link" aria-label="Generate LoginURLÁöÑÁõ¥Êé•ÈìæÊé•" title="Generate LoginURLÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_bdru">Rocket.Chat/apps/meteor/app/custom-oauth/client/CustomOAuth.ts</div><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">requestCredential</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#005CC5">options</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">Meteor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">LoginWithExternalServiceOptions</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function-variable function" style="color:#8250DF">credentialRequestCompleteCallback</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter" style="color:#953800">credentialTokenOrError</span><span class="token parameter operator" style="color:#D73A49">?</span><span class="token parameter operator" style="color:#D73A49">:</span><span class="token parameter" style="color:#953800"> string </span><span class="token parameter operator" style="color:#D73A49">|</span><span class="token parameter" style="color:#953800"> </span><span class="token parameter known-class-name class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">void</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> config </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> loginServices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">loadLoginService</span><span class="token operator" style="color:#D73A49">&lt;</span><span class="token maybe-class-name">OAuthConfiguration</span><span class="token operator" style="color:#D73A49">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">credentialRequestCompleteCallback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token function" style="color:#8250DF">credentialRequestCompleteCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Accounts</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name" style="color:#116329">ConfigError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> credentialToken </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token maybe-class-name">Random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">secret</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> loginStyle </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token maybe-class-name">OAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">_loginStyle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> separator </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">authorizePath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;?&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">!==</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">1</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">?</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;&amp;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;?&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> loginUrl </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">			</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">authorizePath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">separator</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">client_id=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">config</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">clientId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">&amp;redirect_uri=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation function" style="color:#8250DF">encodeURIComponent</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token template-string interpolation">				</span><span class="token template-string interpolation maybe-class-name">OAuth</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#8250DF">_redirectUri</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">name</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"> config</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token template-string interpolation">			</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">&amp;response_type=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation function" style="color:#8250DF">encodeURIComponent</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">responseType</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">+</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">			</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">&amp;state=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation function" style="color:#8250DF">encodeURIComponent</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation maybe-class-name">OAuth</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#8250DF">_stateParam</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">loginStyle</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"> credentialToken</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"> options</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">redirectUrl</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">&amp;scope=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation function" style="color:#8250DF">encodeURIComponent</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token template-string interpolation">				</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">scope</span><span class="token template-string interpolation punctuation" style="color:#393A34">,</span><span class="token template-string interpolation"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token template-string interpolation">			</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token maybe-class-name">OAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">launchLogin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#005CC5">loginService</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			loginStyle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			loginUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			credentialRequestCompleteCallback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			credentialToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#005CC5">popupOptions</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">width</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">900</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">height</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">450</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_bdru">LoginUrl</div><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#005CC5">https</span><span class="token operator" style="color:#D73A49">:</span><span class="token operator" style="color:#D73A49">/</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">login</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">microsoftonline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">d5e685a9</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">3e23</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">42d9</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">9efa</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">15cc5c1ce7db</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">oauth2</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">authorize</span><span class="token operator" style="color:#D73A49">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_id</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">e3845613</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">0331</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">49c0</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">9f11</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">fb6a634242d2</span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redirect_uri</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">https</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">3A</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">2F</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">2F212c</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">34</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">92</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">204</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">228</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ngrok</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">free</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">app</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">2F_oauth</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">2F365oauth</span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response_type</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">code</span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">eyJsb2dpblN0eWxlIjoicmVkaXJlY3Q1LCJjcmVkZW50aWFsV39rZW4iOiJyMHk4Vk54ZlN4MUhmY0lFZXVLbnQ1dnAzNW1aWHM2cHdWTkhzcWRNb1BvIiwiaXNDb3Jkb3ZhIjpmYWxzZSwicmVkaXJlY3RVcmwiOiJodHRwczovLzIxMmMtMzQtOTItMjA0LTIyOC5uf3Jvay1gcmVlLmFwcC9ob21lIn0</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">3D</span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scope</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">openid</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">20profile</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">20email</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="get-authorization-code">Get authorization code<a href="#get-authorization-code" class="hash-link" aria-label="Get authorization codeÁöÑÁõ¥Êé•ÈìæÊé•" title="Get authorization codeÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_bdru">Code</div><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">code</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">AbcAqYXm1SM</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">2UKe</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">hXMXBzn2x4WhOMxA8BJnxH7amNCQtL8APU</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">AgABBAIAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P8Hjlb9sDQamfLxWl_ukGw1Js8IBAlNSq9K3y6MFvkr</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">uCDOasVt1WLipwEY2irrnDPJVI78EONQ8P1jdKlIDjt</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">5sQME63u654FbJGKq8H</span><span class="token operator" style="color:#D73A49">-</span><span class="token maybe-class-name">AV6YrDtaYxfV7cC0YGEcVlbDwYzT0</span><span class="token operator" style="color:#D73A49">-</span><span class="token maybe-class-name">NRlHW17I9OXQmF0wyg0FIPqK8EJa</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">zCKPkGTGwqsPh11Ul5</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">qv90TxMjsfZPd9KZs2Kixiigtx_otW_S6qhbFHCXQVeSG_sO9W0Vn2avdOiAktEILUOWQo</span><span class="token operator" style="color:#D73A49">-</span><span class="token constant" style="color:#005CC5">ZH</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">wmSxfEzibkjvCZYXEtccP1kDxUhQa5Ck4zQWReIjqf2atH3_74ZhFFGMReKSVujqfO46hA7gd4OY7VVGikGlloUWVSFboMXQvQ1GKi7EJ2DEOiIXVM3Uu4_sl3X4dKShcBjSy4kuHfb8MMpQuUhL4NFmBg7A</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">qVl4D1muhayPaJyuT2</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">prggC5ciL7rlgMAWcoGgU5dpC</span><span class="token operator" style="color:#D73A49">-</span><span class="token maybe-class-name">WujQRQVbva1w1HyGI6QL8biiU_fP0wP6</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">0mAsNVsBDhuMtoh0VZ2eKbLWGyvLL0pgTh8XiUMte9t5JgL4dSzlVAcHXUK2HWBeHql2J0LsR73arQHMh5QhlRa94JGB1zNtFnXn5xjfvkYDF3zTuxIwJa4JoEtPu9Krnu6</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">rhA3sHVUNUE6uTBDoIz5udVmAyaa4hNwDEhajSk4qCvEvEgk</span><span class="token operator" style="color:#D73A49">&amp;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="redirect-back-to-server">Redirect back to server<a href="#redirect-back-to-server" class="hash-link" aria-label="Redirect back to serverÁöÑÁõ¥Êé•ÈìæÊé•" title="Redirect back to serverÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_bdru">Code</div><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#005CC5">https</span><span class="token operator" style="color:#D73A49">:</span><span class="token operator" style="color:#D73A49">/</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">212c</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">34</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">92</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">204</span><span class="token operator" style="color:#D73A49">-</span><span class="token number" style="color:#005CC5">228</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ngrok</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">free</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">app</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">_oauth</span><span class="token operator" style="color:#D73A49">/</span><span class="token plain">365oauth</span><span class="token operator" style="color:#D73A49">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code</span><span class="token operator" style="color:#D73A49">=</span><span class="token number" style="color:#005CC5">0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">AbcAqYXm1SM</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">2UKe</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">hXMXBzn2x4WhOMxA8BJnxH7amNCQtL8APU</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">AgABBAIAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P8Hjlb9sDQamfLxWl_ukGw1Js8IBAlNSq9K3y6MFvkr</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">uCDOasVt1WLipwEY2irrnDPJVI78EONQ8P1jdKlIDjt</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">5sQME63u654FbJGKq8H</span><span class="token operator" style="color:#D73A49">-</span><span class="token maybe-class-name">AV6YrDtaYxfV7cC0YGEcVlbDwYzT0</span><span class="token operator" style="color:#D73A49">-</span><span class="token maybe-class-name">NRlHW17I9OXQmF0wyg0FIPqK8EJa</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">zCKPkGTGwqsPh11Ul5</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">qv90TxMjsfZPd9KZs2Kixiigtx_otW_S6qhbFHCXQVeSG_sO9W0Vn2avdOiAktEILUOWQo</span><span class="token operator" style="color:#D73A49">-</span><span class="token constant" style="color:#005CC5">ZH</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">wmSxfEzibkjvCZYXEtccP1kDxUhQa5Ck4zQWReIjqf2atH3_74ZhFFGMReKSVujqfO46hA7gd4OY7VVGikGlloUWVSFboMXQvQ1GKi7EJ2DEOiIXVM3Uu4_sl3X4dKShcBjSy4kuHfb8MMpQuUhL4NFmBg7A</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">qVl4D1muhayPaJyuT2</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">prggC5ciL7rlgMAWcoGgU5dpC</span><span class="token operator" style="color:#D73A49">-</span><span class="token maybe-class-name">WujQRQVbva1w1HyGI6QL8biiU_fP0wP6</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">0mAsNVsBDhuMtoh0VZ2eKbLWGyvLL0pgTh8XiUMte9t5JgL4dSzlVAcHXUK2HWBeHql2J0LsR73arQHMh5QhlRa94JGB1zNtFnXn5xjfvkYDF3zTuxIwJa4JoEtPu9Krnu6</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">rhA3sHVUNUE6uTBDoIz5udVmAyaa4hNwDEhajSk4qCvEvEgk</span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">eyJsb2dpblN0eWxlIjoicmVkaXWERY3QiLCJjcmVkZW50aWFsVG9rZW4iOiJwVjNOcHdRUnlLc21HbUxwc3EtRHlHWjRmeGVwYWl6TXhPRWZmQVNiWmVPIiwiaXNDb3Jkb3ZhIjpmYWxzZSwicmVkaXJlY3RVcmwiOiJodHRwczovLzIxMmMtMzQtOTItMjA0LTIyOC5uZ3Jvay1mcmVlLmFwcC9ob21lIn0</span><span class="token operator" style="color:#D73A49">%</span><span class="token plain">3d</span><span class="token operator" style="color:#D73A49">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session_state</span><span class="token operator" style="color:#D73A49">=</span><span class="token plain">2e1ade24</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">bffe</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">46ef</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">b1c7</span><span class="token operator" style="color:#D73A49">-</span><span class="token plain">934dc8dfbd00#</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_bdru">Rocket.Chat/apps/meteor/app/custom-oauth/server/custom_oauth_server.js</div><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#8250DF">registerService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> self </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token maybe-class-name">OAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">registerService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#CF222E">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter" style="color:#953800">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server registerService query 05&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> response </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">getAccessToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> identity </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">getIdentity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">access_token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> serviceData </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">_OAuthCustom</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">serverURL</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">serverURL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">accessToken</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">access_token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">idToken</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id_token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">expiresAt</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">+</span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">+</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">1000</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">*</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">expires_in</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#005CC5">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token comment" style="color:#6B6B6B;font-style:italic">// only set the token in serviceData if it&#x27;s there. this ensures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token comment" style="color:#6B6B6B;font-style:italic">// that we don&#x27;t lose old ones (since we only get this on the first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token comment" style="color:#6B6B6B;font-style:italic">// log in attempt)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">refresh_token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">refreshToken</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">refresh_token</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			_</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">extend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> identity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> data </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				serviceData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">options</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token literal-property property" style="color:#005CC5">profile</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token literal-property property" style="color:#005CC5">name</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> identity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token comment" style="color:#6B6B6B;font-style:italic">//logger.debug({ msg: &#x27;RegisterService Data&#x27;, response });</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server registerService data 05&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_bdru">registerService query</div><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">custom_oauth_server registerService query </span><span class="token number" style="color:#005CC5">05</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#005CC5">code</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.AgABBAIAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P9DwxS3im8tRSDQdtHxq88XUJxfHdm8qXE_sPaboChfsUSBiWTOOWk5wi3gGT_zILXoafj7-Ae9DUsG9gBPYFk4HXNykWKEhJWyHGeXjR1LVwyZV16w9udhzhZFYpSaTg-jEPcv5sFzbgoxviDNcxcIQTzhmrV2C-SfBCV4-qOZJ4lIcP6eAFm1AexMrnpO5fnI2k-mnZS43E3PiNIQsqPQrItEx1miMNxqAshwQ1QIJaCnzUtus6zd4d6cZma08zQy65wn0axWE2TEXleqOoV81t1-hapdyd-ROpobuYk6ImKWI2Aw3hnjJqWCfJvgkxDLk0ycFuRcdUZRUug8DQtypJk7lrG13NJ7Cx2dbAWNTxLT4kwnvYGjLSLqTk9YQCdwmFgcYsGLk4cqlHTCIg4BJ4ETUxOjYlk2TVmD6vgA3MOZSMREwqyyh4s8iZg9bC2qGQkRL26FNlaiBHRMOGMmptBDo7EONp5RGRMz5A2Wnzepx4w3YRtJUfgYdALRNM6d4lh0l22YUyuFja6HFIS4QIRrHjbOHXyIC2w1_nCfcBPfpw4h75Fmf2iJFvmBeRNdlmU3BMCCnZ2rghkfTSohqzwe2HgBNGKo6pmW6o8WONTDnsIaWtEB4aPsBqL2NX5rOEnQMF2yBsNh_KMhziGjJkQy4ikl1mkAFQ&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#005CC5">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;eyJsb2dpblN0eWxlIjoicmVkaXJlY3QiLCJjcmVkZW50aWFsVG9rZW4iOiJBNnpMMXZEQnNaTkZMTGw0YzE4bW5YQXJsTU9MUU1UMDJyWXpWbkxfcGp0IiwiaXNDb3Jkb3ZhIjpmYWxzZSwicmVkaXJlY3RVcmwiOiJodHRwczovLzIxMmMtMzQtOTItMjA0LTIyOC5uZ3Jvay1mcmVlLmFwcC9ob21lIn0=&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#005CC5">session_state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;2e1ade24-bffe-46ef-b1c7-934dc8dfbd00&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="get-access-token-and-refresh-token">Get access token and refresh token<a href="#get-access-token-and-refresh-token" class="hash-link" aria-label="Get access token and refresh tokenÁöÑÁõ¥Êé•ÈìæÊé•" title="Get access token and refresh tokenÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<p>The RocketChat can use the authorization code to request an access token for the target resource. Authorization codes are short lived. Typically, they expire after about 10 minutes.</p>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">getAccessToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter" style="color:#953800">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> config </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceConfiguration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">configurations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">findOneAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">service</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Accounts</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name" style="color:#116329">ConfigError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">let</span><span class="token plain"> response </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword nil" style="color:#CF222E">undefined</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> headers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string-property property" style="color:#005CC5">&#x27;Content-Type&#x27;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;application/x-www-form-urlencoded&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string-property property" style="color:#005CC5">&#x27;User-Agent&#x27;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userAgent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#6B6B6B;font-style:italic">// http://doc.gitlab.com/ce/api/users.html#Current-user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string-property property" style="color:#005CC5">&#x27;Accept&#x27;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> params </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">URLSearchParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#005CC5">code</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#005CC5">redirect_uri</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token maybe-class-name">OAuth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">_redirectUri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#005CC5">grant_type</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;authorization_code&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token literal-property property" style="color:#005CC5">state</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token comment" style="color:#6B6B6B;font-style:italic">// Only send clientID / secret once on header or payload.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tokenSentVia</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;header&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> b64 </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#CF222E">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">config</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">clientId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation maybe-class-name">OAuth</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#8250DF">openSecret</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation">config</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">secret</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;base64&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Authorization</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">Basic </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">b64</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">secret</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clientId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> request </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">tokenPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">method</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;POST&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token literal-property property" style="color:#005CC5">body</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ok</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">statusText</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			response </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server getAccessToken 03&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> error </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">Failed to complete OAuth handshake with </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F"> at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">tokenPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">. </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">err</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">extend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">response</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token comment" style="color:#6B6B6B;font-style:italic">// if the http response was a json object with an error attribute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">Failed to complete OAuth handshake with </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F"> at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">tokenPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">. </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">response</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">error</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">custom_oauth_server getAccessToken 03 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  token_type: &#x27;Bearer&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expires_in: &#x27;3599&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ext_expires_in: &#x27;3599&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expires_on: &#x27;1719714834&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  access_token: &#x27;PAQABAQIAAAApTwJmzXqdR4BN2miheQMYlbd5ZfbyIQUX1iW0FWGmFGvyjTFuy2zHZ1PoDvLgz0D6hAas62MopvXHFIhX53amdiH8_8t-SAGJsjr--GeBeY4Xa3CBx4-1Wg6KutRkg6nZPb-tOO-JSvdlEwlJ_QqPbv_MKZjoqiDbbK0AwbeiQmQm7uTxfk_EjiXxJGM5nYGoHNeg6rslqYYROsjEw2mFf3kyYYFEbUstPfc6Mc_4t3I8QJTNfC0NELnnNHP1b3khDyXtWEeYgcG4v9bNu3_s8MuUJmF1Cv1oWG8p7uTAmpmt84aQ5lnkO3fcxH4yLOH_CPcYLa8JU4K6EaqW7qq8rlvFCTQk0EzWDfhDjfSXESY8zylhFyOqRKsuBVlUiQ7FU42ukPbNDtdJEcwgOm1m9KIFEU5EDUB7ljyPwF_nwgXHnhF6tsU0XEFR3hCAsp0_TgGvtE5xR7mNHC59ZrY86QpcgTHC3lXyDj58VGgZTiAA&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  refresh_token: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.AgABAwEAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P_RBLQedJRbR8Ll3VPCsjY6zuGnnG6AaZjrFXJGr7hxvjrMD8Azvdxc2BPjThB6qx9JVac8azajaKio_azzrov5EgHgPxCoX5tIL4mV-Yg98cVi5Xm8kOrCjUupc6l0qXRec5Eq69VHJwIUyJrsxpPc8LsHYwDNoKhPWm7fBVKUW0g5ifxg_RBAF43MJYrC5z65tgBRmXwsRJ7ZgDBqnXelYWLKgd-3HG5MkuRpv3JB8vxGRSS5kKdEExU0VRXJ08MMVNHIX_bdzFKyf8LYB2V1sU7gxnWnTmDgQAwvS0Asp0XE-nPY9JtUs_NkgsWD_JQEXv40ib3kOXWNf07ZnVD0DC4E-qE2G76CoEq0l0OWjH9EHf_xhLr21skTWRnaRnnQ8UN1dpyNrf5ymSkhxvTXNOCA6xZUV_ZhjZmjPixig0-8Qx8xDV4RTqnM2NiV8KiR9sL156j31PIeGEp5cagk_lbBqxU2XwGJ9hKI5JbkN3Jg_YVltVKpfkdv4hYzlD94hkepWngLi7q5Sn-Zv-LAC4F8WguDTPt6GjTtOCTG3Yl6BuiMDiBy4-xYM_5BhTdJ1ZCF8wAm-o86U1F1bWTGMa7KQksPsb6AGFGpRcAhbxfki6lETARM18DMVaogACUASffA0ppkSAKoRofJ9-EvXWqodItnTtFmW9WurbNjd0otb1BRP_EIJqKDjd4IAgwbNT0h2C4rWUMEji6ET1KgHun7AGAUTF2EnawYpEzYomCR-pM&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id_token: &#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyIsImtpZCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyJ9.eyJhdWQiOiJlMzg0NTYxMy0wMzMxLTQ5YzAtOWYxMS1mYjZhNjM0MjQyZDIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9kNWU2ODVhOS0zZTIzLTQyZDktOWVmYS0xNWNjNWMxY2U3ZGIvIiwiaWF0IjoxNzE5NzEwOTM0LCJuYmYiOjE3MTk3MTA5MzQsImV4cCI6MTcxOTcxNDgzNCwiYW1yIjpbInB3ZCIsIm1mYSJdLCJmYW1pbHlfbmFtZSI6Ikd1bXAiLCJnaXZlbl9uYW1lIjoiRm9ycmVzdCIsImlwYWRkciI6IjIyMy4xMDQuNDIuODciLCJuYW1lIjoiRm9ycmVzdCBHdW1wIiwib2lkIjoiOTBmNzU5NmItODhiNi00NzY4LTgyMDQtOGM0NzZhNzNmZTI1IiwicmgiOiIwLkFiY0FxWVhtMVNNLTJVS2UtaFhNWEJ6bjJ4TldoT014QThCSm54SDdhbU5DUXRMOEFQVS4iLCJzdWIiOiJLR2NlTEgtSG9FTklONUg0alZ3d2FMSTJydHBILVMyQ1RuSkNIQTB5MGFrIiwidGlkIjoiZDVlNjg1YTktM2UyMy00MmQ5LTllZmEtMTVjYzVjMWNlN2RiIiwidW5pcXVlX25hbWUiOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJGSkI0a0xDRnlVV21ud1ZvdE93OEFRIiwidmVyIjoiMS4wIn0.oGP8qczVpNjzG03en1LmF6BcxOHsSsdU5yNDFDzR7nJsNbnIniPFg8Q9Qr6WWknEvrCGdjMWWf9_7lC6HxK6pr0w28txFOwbPsX_sKFXQBgzTzBUhKuVYmaMv9koFf4UhODyncmDtfiEicBKtOEGf3Rqz534hTXmHXPb9wLIz4_SfmZAa_nuV8my7oBYrrY95rRE-ZfsV5DCoSbu3AiIK4_n21EYfKVE_6J6S46X8r5WeQvLOQ1A4CEZI2lIAToWdT2T1fVYxrsMpNpcfcHtGF6HaD1h_0rmy_QOgZ8nClDI2tx-DnTWLjMoqNCzWFY1p1nLPx_60xqACFqVl_3vdQ&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="return-the-secure-data-to-server">Return the secure data to server<a href="#return-the-secure-data-to-server" class="hash-link" aria-label="Return the secure data to serverÁöÑÁõ¥Êé•ÈìæÊé•" title="Return the secure data to serverÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">getIdentity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter" style="color:#953800">accessToken</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> params </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> headers </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string-property property" style="color:#005CC5">&#x27;User-Agent&#x27;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userAgent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#6B6B6B;font-style:italic">// http://doc.gitlab.com/ce/api/users.html#Current-user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string-property property" style="color:#005CC5">&#x27;Accept&#x27;</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">identityTokenSentVia</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;header&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			headers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Authorization</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">accessToken</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">accessTokenParam</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> accessToken</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity path 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">identityPath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity headers 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity params 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> request </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token function" style="color:#8250DF">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">identityPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">method</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity request 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ok</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">statusText</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> response </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity 04&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">normalizeIdentity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> error </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">Failed to fetch identity from </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F"> at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#CF222E">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">identityPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">. </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">err</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">message</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">extend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">response</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity path 12 https://login.microsoftonline.com/d5e685a9-3e23-42d9-9efa-15cc5c1ce7db/openid/userinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity headers 12 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;User-Agent&#x27;: &#x27;Meteor/METEOR@2.15&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Accept: &#x27;application/json&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Authorization: &#x27;Bearer PAQABAQIAAAApTwJmzXqdR4BN2miheQMYlbd5ZfbyIQUX1iW0FWGmFGvyjTFuy2zHZ1PoDvLgz0D6hAas62MopvXHFIhX53amdiH8_8t-SAGJsjr--GeBeY4Xa3CBx4-1Wg6KutRkg6nZPb-tOO-JSvdlEwlJ_QqPbv_MKZjoqiDbbK0AwbeiQmQm7uTxfk_EjiXxJGM5nYGoHNeg6rslqYYROsjEw2mFf3kyYYFEbUstPfc6Mc_4t3I8QJTNfC0NELnnNHP1b3khDyXtWEeYgcG4v9bNu3_s8MuUJmF1Cv1oWG8p7uTAmpmt84aQ5lnkO3fcxH4yLOH_CPcYLa8JU4K6EaqW7qq8rlvFCTQk0EzWDfhDjfSXESY8zylhFyOqRKsuBVlUiQ7FU42ukPbNDtdJEcwgOm1m9KIFEU5EDUB7ljyPwF_nwgXHnhF6tsU0XEFR3hCAsp0_TgGvtE5xR7mNHC59ZrY86QpcgTHC3lXyDj58VGgZTiAA&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server getIdentity 04 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  amr: &#x27;[&quot;pwd&quot;,&quot;mfa&quot;]&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  family_name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  given_name: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ipaddr: &#x27;223.104.42.87&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &#x27;Forrest Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oid: &#x27;90f7596b-88b6-4768-8204-8c476a73fe25&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rh: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sub: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tid: &#x27;d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unique_name: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upn: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uti: &#x27;H1zdM7Pmbk2z9qeOOQUsAQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ver: &#x27;1.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="colletion-all-user-data-for-login">Colletion all user data for login<a href="#colletion-all-user-data-for-login" class="hash-link" aria-label="Colletion all user data for loginÁöÑÁõ¥Êé•ÈìæÊé•" title="Colletion all user data for loginÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">	registerService() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		const self = this;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		OAuth.registerService(this.name, 2, null, async (query) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			console.log(&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server registerService query 05&quot;, query);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			const response = await self.getAccessToken(query);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			const identity = await self.getIdentity(response.access_token, query);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			const serviceData = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				_OAuthCustom: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				serverURL: self.serverURL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				accessToken: response.access_token,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				idToken: response.id_token,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				expiresAt: +new Date() + 1000 * parseInt(response.expires_in, 10),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// only set the token in serviceData if it&#x27;s there. this ensures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// that we don&#x27;t lose old ones (since we only get this on the first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			// log in attempt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			if (response.refresh_token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				serviceData.refreshToken = response.refresh_token;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			_.extend(serviceData, identity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			const data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				serviceData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				options: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					profile: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						name: identity.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			//logger.debug({ msg: &#x27;RegisterService Data&#x27;, response });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			console.log(&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server registerService data 05&quot;, data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			return data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server registerService data 05 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceData: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _OAuthCustom: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serverURL: &#x27;https://login.microsoftonline.com/d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accessToken: &#x27;PAQABAQIAAAApTwJmzXqdR4BN2miheQMYlbd5ZfbyIQUX1iW0FWGmFGvyjTFuy2zHZ1PoDvLgz0D6hAas62MopvXHFIhX53amdiH8_8t-SAGJsjr--GeBeY4Xa3CBx4-1Wg6KutRkg6nZPb-tOO-JSvdlEwlJ_QqPbv_MKZjoqiDbbK0AwbeiQmQm7uTxfk_EjiXxJGM5nYGoHNeg6rslqYYROsjEw2mFf3kyYYFEbUstPfc6Mc_4t3I8QJTNfC0NELnnNHP1b3khDyXtWEeYgcG4v9bNu3_s8MuUJmF1Cv1oWG8p7uTAmpmt84aQ5lnkO3fcxH4yLOH_CPcYLa8JU4K6EaqW7qq8rlvFCTQk0EzWDfhDjfSXESY8zylhFyOqRKsuBVlUiQ7FU42ukPbNDtdJEcwgOm1m9KIFEU5EDUB7ljyPwF_nwgXHnhF6tsU0XEFR3hCAsp0_TgGvtE5xR7mNHC59ZrY86QpcgTHC3lXyDj58VGgZTiAA&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    idToken: &#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyIsImtpZCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyJ9.eyJhdWQiOiJlMzg0NTYxMy0wMzMxLTQ5YzAtOWYxMS1mYjZhNjM0MjQyZDIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9kNWU2ODVhOS0zZTIzLTQyZDktOWVmYS0xNWNjNWMxY2U3ZGIvIiwiaWF0IjoxNzE5NzEwOTM0LCJuYmYiOjE3MTk3MTA5MzQsImV4cCI6MTcxOTcxNDgzNCwiYW1yIjpbInB3ZCIsIm1mYSJdLCJmYW1pbHlfbmFtZSI6Ikd1bXAiLCJnaXZlbl9uYW1lIjoiRm9ycmVzdCIsImlwYWRkciI6IjIyMy4xMDQuNDIuODciLCJuYW1lIjoiRm9ycmVzdCBHdW1wIiwib2lkIjoiOTBmNzU5NmItODhiNi00NzY4LTgyMDQtOGM0NzZhNzNmZTI1IiwicmgiOiIwLkFiY0FxWVhtMVNNLTJVS2UtaFhNWEJ6bjJ4TldoT014QThCSm54SDdhbU5DUXRMOEFQVS4iLCJzdWIiOiJLR2NlTEgtSG9FTklONUg0alZ3d2FMSTJydHBILVMyQ1RuSkNIQTB5MGFrIiwidGlkIjoiZDVlNjg1YTktM2UyMy00MmQ5LTllZmEtMTVjYzVjMWNlN2RiIiwidW5pcXVlX25hbWUiOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJGSkI0a0xDRnlVV21ud1ZvdE93OEFRIiwidmVyIjoiMS4wIn0.oGP8qczVpNjzG03en1LmF6BcxOHsSsdU5yNDFDzR7nJsNbnIniPFg8Q9Qr6WWknEvrCGdjMWWf9_7lC6HxK6pr0w28txFOwbPsX_sKFXQBgzTzBUhKuVYmaMv9koFf4UhODyncmDtfiEicBKtOEGf3Rqz534hTXmHXPb9wLIz4_SfmZAa_nuV8my7oBYrrY95rRE-ZfsV5DCoSbu3AiIK4_n21EYfKVE_6J6S46X8r5WeQvLOQ1A4CEZI2lIAToWdT2T1fVYxrsMpNpcfcHtGF6HaD1h_0rmy_QOgZ8nClDI2tx-DnTWLjMoqNCzWFY1p1nLPx_60xqACFqVl_3vdQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expiresAt: 1719714834151,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    refreshToken: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.AgABAwEAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P_RBLQedJRbR8Ll3VPCsjY6zuGnnG6AaZjrFXJGr7hxvjrMD8Azvdxc2BPjThB6qx9JVac8azajaKio_azzrov5EgHgPxCoX5tIL4mV-Yg98cVi5Xm8kOrCjUupc6l0qXRec5Eq69VHJwIUyJrsxpPc8LsHYwDNoKhPWm7fBVKUW0g5ifxg_RBAF43MJYrC5z65tgBRmXwsRJ7ZgDBqnXelYWLKgd-3HG5MkuRpv3JB8vxGRSS5kKdEExU0VRXJ08MMVNHIX_bdzFKyf8LYB2V1sU7gxnWnTmDgQAwvS0Asp0XE-nPY9JtUs_NkgsWD_JQEXv40ib3kOXWNf07ZnVD0DC4E-qE2G76CoEq0l0OWjH9EHf_xhLr21skTWRnaRnnQ8UN1dpyNrf5ymSkhxvTXNOCA6xZUV_ZhjZmjPixig0-8Qx8xDV4RTqnM2NiV8KiR9sL156j31PIeGEp5cagk_lbBqxU2XwGJ9hKI5JbkN3Jg_YVltVKpfkdv4hYzlD94hkepWngLi7q5Sn-Zv-LAC4F8WguDTPt6GjTtOCTG3Yl6BuiMDiBy4-xYM_5BhTdJ1ZCF8wAm-o86U1F1bWTGMa7KQksPsb6AGFGpRcAhbxfki6lETARM18DMVaogACUASffA0ppkSAKoRofJ9-EvXWqodItnTtFmW9WurbNjd0otb1BRP_EIJqKDjd4IAgwbNT0h2C4rWUMEji6ET1KgHun7AGAUTF2EnawYpEzYomCR-pM&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amr: &#x27;[&quot;pwd&quot;,&quot;mfa&quot;]&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    family_name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    given_name: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipaddr: &#x27;223.104.42.87&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oid: &#x27;90f7596b-88b6-4768-8204-8c476a73fe25&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rh: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sub: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tid: &#x27;d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unique_name: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upn: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uti: &#x27;H1zdM7Pmbk2z9qeOOQUsAQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ver: &#x27;1.0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="about-hooks-loop">About hooks loop<a href="#about-hooks-loop" class="hash-link" aria-label="About hooks loopÁöÑÁõ¥Êé•ÈìæÊé•" title="About hooks loopÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> updateOrCreateUserFromExternalService </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token maybe-class-name">Accounts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#8250DF">updateOrCreateUserFromExternalServiceAsync</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#D73A49">...</span><span class="token plain">args </span><span class="token comment" style="color:#6B6B6B;font-style:italic">/* serviceName, serviceData, options*/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword control-flow" style="color:#CF222E">for</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> hook </span><span class="token keyword" style="color:#CF222E">of</span><span class="token plain"> </span><span class="token maybe-class-name">BeforeUpdateOrCreateUserFromExternalService</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server hook hook hook hook hook XXXXXXXXXXXXXXXXXXXXXXXXXXx&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> user </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> updateOrCreateUserFromExternalService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> fullUser </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">Users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">findOneById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">settings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;LDAP_Update_Data_On_OAuth_Login&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token constant" style="color:#005CC5">LDAP</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">loginAuthenticatedUserRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fullUser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> callbacks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;afterValidateNewOAuthUser&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#005CC5">identity</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		serviceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token literal-property property" style="color:#005CC5">user</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> fullUser</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#8250DF">addHookToProcessUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token maybe-class-name">BeforeUpdateOrCreateUserFromExternalService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceData </span><span class="token comment" style="color:#6B6B6B;font-style:italic">/* , options*/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser serviceName 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser this.name 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser this.keyField 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keyField</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser serviceData 12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceName </span><span class="token operator" style="color:#D73A49">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword" style="color:#CF222E">let</span><span class="token plain"> user </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword nil" style="color:#CF222E">undefined</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keyField</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;username&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					user </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mergeUsersDistinctServices</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token operator" style="color:#D73A49">?</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">Users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">findOneByUsernameIgnoringCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">Users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">findOneByUsernameAndServiceNameIgnoringCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keyField</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;email&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					user </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mergeUsersDistinctServices</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token operator" style="color:#D73A49">?</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">Users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">findOneByEmailAddress</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">Users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">findOneByEmailAddressAndServiceNameIgnoringCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXx gitcoins return 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> callbacks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;afterProcessOAuthUser&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> serviceName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXx gitcoins user 18&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token comment" style="color:#6B6B6B;font-style:italic">// User already created or merged and has identical name as before</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">services</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">services</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">services</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">serviceName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keyField</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">||</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">!</span><span class="token plain">serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">||</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">emails</span><span class="token operator" style="color:#D73A49">?.</span><span class="token method function property-access" style="color:#8250DF">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter" style="color:#953800"> address </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#D73A49">=&gt;</span><span class="token plain"> address </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXx gitcoins return 2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token keyword control-flow" style="color:#CF222E">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXx gitcoins user 19&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mergeUsers</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">!==</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token keyword control-flow" style="color:#CF222E">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#CF222E">new</span><span class="token plain"> </span><span class="token class-name" style="color:#116329">Meteor</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name" style="color:#116329">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&#x27;CustomOAuth&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">User with username </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">user</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">username</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F"> already exists</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> serviceIdKey </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token template-string string" style="color:#C6105F">services.</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">serviceName</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#C6105F">.id</span><span class="token template-string template-punctuation string" style="color:#C6105F">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword" style="color:#CF222E">const</span><span class="token plain"> update </span><span class="token operator" style="color:#D73A49">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token literal-property property" style="color:#005CC5">$set</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token literal-property property" style="color:#005CC5">name</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token spread operator" style="color:#D73A49">...</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#CF222E">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keyField</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">===</span><span class="token plain"> </span><span class="token string" style="color:#C6105F">&#x27;username&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&amp;&amp;</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token plain"> </span><span class="token operator" style="color:#D73A49">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">emails</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">address</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">verified</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> </span><span class="token boolean" style="color:#005CC5">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">serviceIdKey</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> serviceData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token console class-name" style="color:#116329">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#C6105F">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXx gitcoins user 20&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token keyword control-flow" style="color:#CF222E">await</span><span class="token plain"> </span><span class="token maybe-class-name">Users</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#8250DF">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#005CC5">_id</span><span class="token operator" style="color:#D73A49">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> update</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server hook hook hook hook hook XXXXXXXXXXXXXXXXXXXXXXXXXXx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser serviceName 12 365oauth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser this.name 12 gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser this.keyField 12 undefined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser serviceData 12 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _OAuthCustom: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serverURL: &#x27;https://login.microsoftonline.com/d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessToken: &#x27;PAQABAQIAAAApTwJmzXqdR4BN2miheQMYlbd5ZfbyIQUX1iW0FWGmFGvyjTFuy2zHZ1PoDvLgz0D6hAas62MopvXHFIhX53amdiH8_8t-SAGJsjr--GeBeY4Xa3CBx4-1Wg6KutRkg6nZPb-tOO-JSvdlEwlJ_QqPbv_MKZjoqiDbbK0AwbeiQmQm7uTxfk_EjiXxJGM5nYGoHNeg6rslqYYROsjEw2mFf3kyYYFEbUstPfc6Mc_4t3I8QJTNfC0NELnnNHP1b3khDyXtWEeYgcG4v9bNu3_s8MuUJmF1Cv1oWG8p7uTAmpmt84aQ5lnkO3fcxH4yLOH_CPcYLa8JU4K6EaqW7qq8rlvFCTQk0EzWDfhDjfSXESY8zylhFyOqRKsuBVlUiQ7FU42ukPbNDtdJEcwgOm1m9KIFEU5EDUB7ljyPwF_nwgXHnhF6tsU0XEFR3hCAsp0_TgGvtE5xR7mNHC59ZrY86QpcgTHC3lXyDj58VGgZTiAA&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  idToken: &#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyIsImtpZCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyJ9.eyJhdWQiOiJlMzg0NTYxMy0wMzMxLTQ5YzAtOWYxMS1mYjZhNjM0MjQyZDIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9kNWU2ODVhOS0zZTIzLTQyZDktOWVmYS0xNWNjNWMxY2U3ZGIvIiwiaWF0IjoxNzE5NzEwOTM0LCJuYmYiOjE3MTk3MTA5MzQsImV4cCI6MTcxOTcxNDgzNCwiYW1yIjpbInB3ZCIsIm1mYSJdLCJmYW1pbHlfbmFtZSI6Ikd1bXAiLCJnaXZlbl9uYW1lIjoiRm9ycmVzdCIsImlwYWRkciI6IjIyMy4xMDQuNDIuODciLCJuYW1lIjoiRm9ycmVzdCBHdW1wIiwib2lkIjoiOTBmNzU5NmItODhiNi00NzY4LTgyMDQtOGM0NzZhNzNmZTI1IiwicmgiOiIwLkFiY0FxWVhtMVNNLTJVS2UtaFhNWEJ6bjJ4TldoT014QThCSm54SDdhbU5DUXRMOEFQVS4iLCJzdWIiOiJLR2NlTEgtSG9FTklONUg0alZ3d2FMSTJydHBILVMyQ1RuSkNIQTB5MGFrIiwidGlkIjoiZDVlNjg1YTktM2UyMy00MmQ5LTllZmEtMTVjYzVjMWNlN2RiIiwidW5pcXVlX25hbWUiOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJGSkI0a0xDRnlVV21ud1ZvdE93OEFRIiwidmVyIjoiMS4wIn0.oGP8qczVpNjzG03en1LmF6BcxOHsSsdU5yNDFDzR7nJsNbnIniPFg8Q9Qr6WWknEvrCGdjMWWf9_7lC6HxK6pr0w28txFOwbPsX_sKFXQBgzTzBUhKuVYmaMv9koFf4UhODyncmDtfiEicBKtOEGf3Rqz534hTXmHXPb9wLIz4_SfmZAa_nuV8my7oBYrrY95rRE-ZfsV5DCoSbu3AiIK4_n21EYfKVE_6J6S46X8r5WeQvLOQ1A4CEZI2lIAToWdT2T1fVYxrsMpNpcfcHtGF6HaD1h_0rmy_QOgZ8nClDI2tx-DnTWLjMoqNCzWFY1p1nLPx_60xqACFqVl_3vdQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expiresAt: 1719714834151,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  refreshToken: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.AgABAwEAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P_RBLQedJRbR8Ll3VPCsjY6zuGnnG6AaZjrFXJGr7hxvjrMD8Azvdxc2BPjThB6qx9JVac8azajaKio_azzrov5EgHgPxCoX5tIL4mV-Yg98cVi5Xm8kOrCjUupc6l0qXRec5Eq69VHJwIUyJrsxpPc8LsHYwDNoKhPWm7fBVKUW0g5ifxg_RBAF43MJYrC5z65tgBRmXwsRJ7ZgDBqnXelYWLKgd-3HG5MkuRpv3JB8vxGRSS5kKdEExU0VRXJ08MMVNHIX_bdzFKyf8LYB2V1sU7gxnWnTmDgQAwvS0Asp0XE-nPY9JtUs_NkgsWD_JQEXv40ib3kOXWNf07ZnVD0DC4E-qE2G76CoEq0l0OWjH9EHf_xhLr21skTWRnaRnnQ8UN1dpyNrf5ymSkhxvTXNOCA6xZUV_ZhjZmjPixig0-8Qx8xDV4RTqnM2NiV8KiR9sL156j31PIeGEp5cagk_lbBqxU2XwGJ9hKI5JbkN3Jg_YVltVKpfkdv4hYzlD94hkepWngLi7q5Sn-Zv-LAC4F8WguDTPt6GjTtOCTG3Yl6BuiMDiBy4-xYM_5BhTdJ1ZCF8wAm-o86U1F1bWTGMa7KQksPsb6AGFGpRcAhbxfki6lETARM18DMVaogACUASffA0ppkSAKoRofJ9-EvXWqodItnTtFmW9WurbNjd0otb1BRP_EIJqKDjd4IAgwbNT0h2C4rWUMEji6ET1KgHun7AGAUTF2EnawYpEzYomCR-pM&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  amr: &#x27;[&quot;pwd&quot;,&quot;mfa&quot;]&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  family_name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  given_name: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ipaddr: &#x27;223.104.42.87&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oid: &#x27;90f7596b-88b6-4768-8204-8c476a73fe25&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rh: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sub: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tid: &#x27;d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unique_name: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upn: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uti: &#x27;H1zdM7Pmbk2z9qeOOQUsAQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ver: &#x27;1.0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  username: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server hook hook hook hook hook XXXXXXXXXXXXXXXXXXXXXXXXXXx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser serviceName 12 365oauth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser this.name 12 365oauth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser this.keyField 12 username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXx custom_oauth_server addHookToProcessUser serviceData 12 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _OAuthCustom: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serverURL: &#x27;https://login.microsoftonline.com/d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessToken: &#x27;PAQABAQIAAAApTwJmzXqdR4BN2miheQMYlbd5ZfbyIQUX1iW0FWGmFGvyjTFuy2zHZ1PoDvLgz0D6hAas62MopvXHFIhX53amdiH8_8t-SAGJsjr--GeBeY4Xa3CBx4-1Wg6KutRkg6nZPb-tOO-JSvdlEwlJ_QqPbv_MKZjoqiDbbK0AwbeiQmQm7uTxfk_EjiXxJGM5nYGoHNeg6rslqYYROsjEw2mFf3kyYYFEbUstPfc6Mc_4t3I8QJTNfC0NELnnNHP1b3khDyXtWEeYgcG4v9bNu3_s8MuUJmF1Cv1oWG8p7uTAmpmt84aQ5lnkO3fcxH4yLOH_CPcYLa8JU4K6EaqW7qq8rlvFCTQk0EzWDfhDjfSXESY8zylhFyOqRKsuBVlUiQ7FU42ukPbNDtdJEcwgOm1m9KIFEU5EDUB7ljyPwF_nwgXHnhF6tsU0XEFR3hCAsp0_TgGvtE5xR7mNHC59ZrY86QpcgTHC3lXyDj58VGgZTiAA&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  idToken: &#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyIsImtpZCI6Ik1HTHFqOThWTkxvWGFGZnBKQ0JwZ0I0SmFLcyJ9.eyJhdWQiOiJlMzg0NTYxMy0wMzMxLTQ5YzAtOWYxMS1mYjZhNjM0MjQyZDIiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9kNWU2ODVhOS0zZTIzLTQyZDktOWVmYS0xNWNjNWMxY2U3ZGIvIiwiaWF0IjoxNzE5NzEwOTM0LCJuYmYiOjE3MTk3MTA5MzQsImV4cCI6MTcxOTcxNDgzNCwiYW1yIjpbInB3ZCIsIm1mYSJdLCJmYW1pbHlfbmFtZSI6Ikd1bXAiLCJnaXZlbl9uYW1lIjoiRm9ycmVzdCIsImlwYWRkciI6IjIyMy4xMDQuNDIuODciLCJuYW1lIjoiRm9ycmVzdCBHdW1wIiwib2lkIjoiOTBmNzU5NmItODhiNi00NzY4LTgyMDQtOGM0NzZhNzNmZTI1IiwicmgiOiIwLkFiY0FxWVhtMVNNLTJVS2UtaFhNWEJ6bjJ4TldoT014QThCSm54SDdhbU5DUXRMOEFQVS4iLCJzdWIiOiJLR2NlTEgtSG9FTklONUg0alZ3d2FMSTJydHBILVMyQ1RuSkNIQTB5MGFrIiwidGlkIjoiZDVlNjg1YTktM2UyMy00MmQ5LTllZmEtMTVjYzVjMWNlN2RiIiwidW5pcXVlX25hbWUiOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJGb3JyZXN0R3VtcEBHaXRjb2lucy5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJGSkI0a0xDRnlVV21ud1ZvdE93OEFRIiwidmVyIjoiMS4wIn0.oGP8qczVpNjzG03en1LmF6BcxOHsSsdU5yNDFDzR7nJsNbnIniPFg8Q9Qr6WWknEvrCGdjMWWf9_7lC6HxK6pr0w28txFOwbPsX_sKFXQBgzTzBUhKuVYmaMv9koFf4UhODyncmDtfiEicBKtOEGf3Rqz534hTXmHXPb9wLIz4_SfmZAa_nuV8my7oBYrrY95rRE-ZfsV5DCoSbu3AiIK4_n21EYfKVE_6J6S46X8r5WeQvLOQ1A4CEZI2lIAToWdT2T1fVYxrsMpNpcfcHtGF6HaD1h_0rmy_QOgZ8nClDI2tx-DnTWLjMoqNCzWFY1p1nLPx_60xqACFqVl_3vdQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expiresAt: 1719714834151,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  refreshToken: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.AgABAwEAAAApTwJmzXqdR4BN2miheQMYAgDs_wUA9P_RBLQedJRbR8Ll3VPCsjY6zuGnnG6AaZjrFXJGr7hxvjrMD8Azvdxc2BPjThB6qx9JVac8azajaKio_azzrov5EgHgPxCoX5tIL4mV-Yg98cVi5Xm8kOrCjUupc6l0qXRec5Eq69VHJwIUyJrsxpPc8LsHYwDNoKhPWm7fBVKUW0g5ifxg_RBAF43MJYrC5z65tgBRmXwsRJ7ZgDBqnXelYWLKgd-3HG5MkuRpv3JB8vxGRSS5kKdEExU0VRXJ08MMVNHIX_bdzFKyf8LYB2V1sU7gxnWnTmDgQAwvS0Asp0XE-nPY9JtUs_NkgsWD_JQEXv40ib3kOXWNf07ZnVD0DC4E-qE2G76CoEq0l0OWjH9EHf_xhLr21skTWRnaRnnQ8UN1dpyNrf5ymSkhxvTXNOCA6xZUV_ZhjZmjPixig0-8Qx8xDV4RTqnM2NiV8KiR9sL156j31PIeGEp5cagk_lbBqxU2XwGJ9hKI5JbkN3Jg_YVltVKpfkdv4hYzlD94hkepWngLi7q5Sn-Zv-LAC4F8WguDTPt6GjTtOCTG3Yl6BuiMDiBy4-xYM_5BhTdJ1ZCF8wAm-o86U1F1bWTGMa7KQksPsb6AGFGpRcAhbxfki6lETARM18DMVaogACUASffA0ppkSAKoRofJ9-EvXWqodItnTtFmW9WurbNjd0otb1BRP_EIJqKDjd4IAgwbNT0h2C4rWUMEji6ET1KgHun7AGAUTF2EnawYpEzYomCR-pM&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  amr: &#x27;[&quot;pwd&quot;,&quot;mfa&quot;]&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  family_name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  given_name: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ipaddr: &#x27;223.104.42.87&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oid: &#x27;90f7596b-88b6-4768-8204-8c476a73fe25&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rh: &#x27;0.AbcAqYXm1SM-2UKe-hXMXBzn2xNWhOMxA8BJnxH7amNCQtL8APU.&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sub: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tid: &#x27;d5e685a9-3e23-42d9-9efa-15cc5c1ce7db&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unique_name: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upn: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uti: &#x27;H1zdM7Pmbk2z9qeOOQUsAQ&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ver: &#x27;1.0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  id: &#x27;KGceLH-HoENIN5H4jVwwaLI2rtpH-S2CTnJCHA0y0ak&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  username: &#x27;Forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email: &#x27;ForrestGump@Gitcoins.onmicrosoft.com&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="login-from-the-client">Login from the client<a href="#login-from-the-client" class="hash-link" aria-label="Login from the clientÁöÑÁõ¥Êé•ÈìæÊé•" title="Login from the clientÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">XXXXXXXXXXXXXXXXXXXXXXXXXXXXx gitcoins return 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..................... authenticaiton server Account validateLoginAttemptAsync 10 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: &#x27;365oauth&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowed: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  methodName: &#x27;login&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  methodArguments: [ { oauth: [Object] } ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _id: &#x27;HMDuxBovxYtNuxtuE&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    createdAt: 2024-06-05T04:06:25.944Z,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      email2fa: [Object],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      email: [Object],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resume: [Object],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;365oauth&#x27;: [Object],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      password: [Object],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      microsoft356: [Object],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emailCode: [Object]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    emails: [ [Object] ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: &#x27;user&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roles: [ &#x27;user&#x27; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status: &#x27;offline&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _updatedAt: 2024-06-25T01:51:50.840Z,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: &#x27;Gump&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: &#x27;forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __rooms: [ &#x27;GENERAL&#x27; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastLogin: 2024-06-25T01:51:13.025Z,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    statusConnection: &#x27;offline&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    utcOffset: 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    statusText: &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    statusDefault: &#x27;online&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    settings: { profile: {} }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connection: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: &#x27;hDZQhgrS925j22fZN&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close: [Function: close],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpHeaders: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;x-forwarded-port&#x27;: &#x27;80&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;x-forwarded-proto&#x27;: &#x27;https,http&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;x-forwarded-host&#x27;: &#x27;212c-34-92-204-228.ngrok-free.app&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;x-forwarded-for&#x27;: &#x27;2a11:3:200::2057,127.0.0.1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;sec-fetch-site&#x27;: &#x27;same-origin&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;sec-fetch-mode&#x27;: &#x27;cors&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;sec-fetch-dest&#x27;: &#x27;empty&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;sec-ch-ua-platform&#x27;: &#x27;&quot;Windows&quot;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;sec-ch-ua-mobile&#x27;: &#x27;?0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;sec-ch-ua&#x27;: &#x27;&quot;Not/A)Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;126&quot;, &quot;Google Chrome&quot;;v=&quot;126&quot;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      referer: &#x27;https://212c-34-92-204-228.ngrok-free.app/home&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      priority: &#x27;u=1, i&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      origin: &#x27;https://212c-34-92-204-228.ngrok-free.app&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;content-type&#x27;: &#x27;application/json&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;accept-language&#x27;: &#x27;en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;accept-encoding&#x27;: &#x27;gzip, deflate, br, zstd&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      accept: &#x27;application/json&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;content-length&#x27;: &#x27;232&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;user-agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      host: &#x27;212c-34-92-204-228.ngrok-free.app&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      connection: &#x27;keep-alive&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clientAddress: &#x27;127.0.0.1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token: undefined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Exception while invoking method login errorClass [Error]: TOTP Required [totp-required]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at app/2fa/server/code/index.ts:211:9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at app/2fa/server/loginHandler.ts:44:3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at lib/callbacks/callbacksBase.ts:68:5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at app/authentication/server/startup/index.js:434:7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at app/authentication/server/startup/index.js:455:17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/callback-hook/hook.js:177:18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/meteor.js:365:18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/accounts-base/accounts_server.js:226:15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Hook.forEach (packages/callback-hook/hook.js:124:15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at AccountsServer._validateLogin (packages/accounts-base/accounts_server.js:223:29)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/accounts-base/accounts_server.js:473:10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/accounts-base/accounts_server.js:653:7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/meteor.js:367:22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Meteor.EnvironmentVariable.EVp.withValue (packages/meteor.js:1389:31)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at packages/ddp-server/livedata_server.js:1854:36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at new Promise (&lt;anonymous&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Server.applyAsync (packages/ddp-server/livedata_server.js:1853:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Server.callAsync (packages/ddp-server/livedata_server.js:1779:17)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at app/api/server/v1/misc.ts:620:33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =&gt; awaited here:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at Function.Promise.await (/home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/promise_server.js:56:12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at app/api/server/v1/misc.ts:620:17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at /home/gitcoins/.meteor/packages/promise/.0.12.2.1v51k7w.6dob++os+web.browser+web.browser.legacy+web.cordova/npm/node_modules/meteor-promise/fiber_pool.js:43:40 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  isClientSafe: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error: &#x27;totp-required&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reason: &#x27;TOTP Required&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  details: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    method: &#x27;email&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    codeGenerated: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    emailOrUsername: &#x27;forrest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    availableMethods: [ &#x27;email&#x27; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  errorType: &#x27;Meteor.Error&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====== BEGIN MAIL #34 ======</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(Mail not sent; to enable sending, set the MAIL_URL environment variable.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: multipart/alternative;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> boundary=&quot;--_NmP-7245379ef3eb6267-Part_1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To: ForrestGump@gitcoins.onmicrosoft.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Subject: Authentication code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Message-ID: &lt;b062f356-f598-1d0e-d7e4-5728ab80ebaa@rocket-chat-server&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Sun, 30 Jun 2024 01:34:00 +0000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIME-Version: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----_NmP-7245379ef3eb6267-Part_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/plain; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: 7bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here is your authentication code:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">274-035</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" title="Â§çÂà∂" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_PgCn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_bsQG"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_o5H7 alert alert--info"><div class="admonitionHeading_FzoX"><span class="admonitionIcon_rXq6"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>JitPack or Sonatype OSSRH?</div><div class="admonitionContent_Knsx"><p>The simplest choice would be <a href="https://jitpack.io/" target="_blank" rel="noopener noreferrer">JitPack</a>, which might not give you much in terms of customization or control, but is very easy to get started with. All you have to do is publish your project on GitHub, and JitPack should be able to build and distribute it immediately. If you‚Äôre new to libraries, this is a great choice for getting your code out there.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_o5H7 alert alert--warning"><div class="admonitionHeading_FzoX"><span class="admonitionIcon_rXq6"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Help</div><div class="admonitionContent_Knsx"><p>I try to use JitPack but failed to config. If you success to use JitPack in the <a href="https://github.com/GetStream/stream-chat-android" target="_blank" rel="noopener noreferrer">Android SDK for Stream Chat</a>, please let me know. Thanks.</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_SSbb" id="overview">Overview<a href="#overview" class="hash-link" aria-label="OverviewÁöÑÁõ¥Êé•ÈìæÊé•" title="OverviewÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<p>Here&#x27;s a quick overview of the steps we&#x27;ll go through:</p>
<ul>
<li>Registering a Jira account with Sonatype, and verifying your ownership of the group ID you want to publish your artifact with</li>
<li>Generating a GPG key pair for signing your artifacts, publishing your public key, and exporting your private key</li>
<li>Setting up Gradle tasks that can sign upload your artifacts to a staging repository</li>
<li>Manually going through the process of checking your artifacts in the staging repo and releasing them via the Sonatype web UI</li>
<li>Automating the close &amp; release flow with a Gradle plugin</li>
<li>Configuring CI workflows with GitHub Actions to automate all of the above
A lot of ground to cover - let‚Äôs go!</li>
</ul>
<p>After choosing a language and an avatar, you‚Äôll end up on this landing page - click on Create an issue</p>
<ul>
<li><strong>Summary</strong>: Create repository for your.group.id.here</li>
<li><strong>Description</strong>: An optional, quick summary of what your project is.</li>
<li><strong>Group Id</strong>: Your group ID, as described a few sections earlier.</li>
<li><strong>Project URL</strong>: If your project has a webpage, the URL of that page. This can also be just the GitHub repository.</li>
<li><strong>SCM url</strong>: Your source control URL, i.e. the GitHub repository link.</li>
<li><strong>Username(s)</strong>: If you want additional users (on top of the one you‚Äôre using for this process) to have deploy access for your group ID, you can list them here.</li>
<li><strong>Already Synced to Central</strong>: If you‚Äôre just getting started, this should be No.</li>
</ul>
<p>Soon after opening it, your issue will get a comment telling you to verify that you own the domain corresponding to your group ID. To comply with this, add the required TXT record to your domain - how to do this will depend on where your domain is registered, but it should be a fairly simple task. Login to the <a href="https://dcc.godaddy.com/control/portfolio/gitcoins.io/settings" target="_blank" rel="noopener noreferrer">goDaddy</a> to set the TXT record with the guide from <a href="https://issues.sonatype.org/browse/OSSRH-97587" target="_blank" rel="noopener noreferrer">the issue created</a> in jira for Sonatype.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://crowdin.com/project/docusaurus-v2/zh-CN" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_IMw_" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ÁºñËæëÊ≠§È°µ</a></div><div class="col lastUpdated_DtqZ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Êñá‰ª∂ÈÄâÈ°πÂç°"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-CN/docs/rocketchat/rocketchat-oauth"><div class="pagination-nav__sublabel">‰∏ä‰∏ÄÈ°µ</div><div class="pagination-nav__label">RocketChat Oauth</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-CN/docs/rocketchat/rocketchat-microsoft-oauth"><div class="pagination-nav__sublabel">‰∏ã‰∏ÄÈ°µ</div><div class="pagination-nav__label">Auth with Microsoft code flow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_RLlU thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rocketchat-oauth-configuration" class="table-of-contents__link toc-highlight">RocketChat Oauth configuration</a></li><li><a href="#generate-loginurl" class="table-of-contents__link toc-highlight">Generate LoginURL</a></li><li><a href="#get-authorization-code" class="table-of-contents__link toc-highlight">Get authorization code</a></li><li><a href="#redirect-back-to-server" class="table-of-contents__link toc-highlight">Redirect back to server</a></li><li><a href="#get-access-token-and-refresh-token" class="table-of-contents__link toc-highlight">Get access token and refresh token</a></li><li><a href="#return-the-secure-data-to-server" class="table-of-contents__link toc-highlight">Return the secure data to server</a></li><li><a href="#colletion-all-user-data-for-login" class="table-of-contents__link toc-highlight">Colletion all user data for login</a></li><li><a href="#about-hooks-loop" class="table-of-contents__link toc-highlight">About hooks loop</a></li><li><a href="#login-from-the-client" class="table-of-contents__link toc-highlight">Login from the client</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/vulnsystem/vulnsystem.github.io/edit/main/website/src/pages/index.tsx" target="_blank" rel="noopener noreferrer" class="footer__link-item">Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/vulnsystem/vulnsystem.github.io/edit/main/website/docusaurus.config.ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Configuration<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/vulnsystem/vulnsystem.github.io/edit/main/website/sidebars.ts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sidebar<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/vulnsystem/vulnsystem.github.io/actions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Actions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/vulnsystem/vulnsystem.github.io/tree/main/website/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/feature-requests">Feature Requests</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/support">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/changelog">Changelog</a></li><li class="footer__item"><a href="https://github.com/vulnsystem/vulnsystem.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <a href="https://www.netlify.com" target="_blank" rel="noreferrer noopener" aria-label="Deploys by Netlify">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.fb.com" rel="noopener noreferrer" class="footerLogoLink_CiM_"><img src="/zh-CN/img/meta_opensource_logo_negative.svg" alt="Meta Open Source Logo" class="footer__logo themedComponent_bJGS themedComponent--light_LEkC"><img src="/zh-CN/img/meta_opensource_logo_negative.svg" alt="Meta Open Source Logo" class="footer__logo themedComponent_bJGS themedComponent--dark_jnGk"></a></div><div class="footer__copyright">Copyright ¬© 2024 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>